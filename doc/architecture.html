<!--
   Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-  2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="description" content="Apache Shiro is a powerful and easy-to-use Java security framework that performs authentication, authorization, cryptography, and session management.">
    <meta name="google-site-verification" content="QIax6uT5UX3enoU0G8Pz2pXbQ45KaQuHZ3nCh9V27mw">
    <meta name="msvalidate.01" content="0B57EB46CBFAD8FD45008D2DB6B6C68C">
    <meta name="y_key" content="e47896cd6bae4920">

    <title>
                    Apache Shiro | Java Security Framework
        </title>


    <link rel="icon" type="image/vnd.microsoft.icon" href="assets/images/favicon.ico">

    <link rel="stylesheet" type="text/css" href="assets/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="assets/css/confluence.css" media="screen">
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">

  
</head>

<body>
    <div id="top-bar"></div>

    <div class="wrapper">

        <div id="header">
            <a href="index.html"><div id="logo"></div></a>
            <ul class="navigation">
                <li><a href="get-started.html">Get Started</a></li>
                <li><a href="documentation.html">Docs</a></li>
                <li><a href="web-features.html">Web Apps</a></li>
                <li><a href="integration.html">Integrations</a></li>
                <li><a href="features.html">Features</a></li>
                <li><a href="community.html">Community</a></li>
            </ul>
        </div>

        <div id="content">

            <h1><a name="Architecture-ApacheShiroArchitecture"></a>Apache Shiro的架构</h1>

<p>Apache Shiro的设计目标是通过其直观易用来简化安全应用的开发， Shiro的核心设计以多数人对应用安全的认识为模型——在某个环境下某人或某物与应用的交互。</p>

<p>应用软件通常是基于用户故事（User Story）而设计，就是说我们经常会根据用户如何与系统交互来设计界面或服务接口。举个例子，“如果用户登录了系统，你会向其显示一个按钮，单击后可以看到他们的帐号信息。如果没有登录，则会显示一个登录按钮。”</p>

<p>这个例子说明应用主要是来满足用户的需求与需要，即使这个“用户”是其他的软件系统而不是人类，你还是要基于谁（或什么）在跟你的软件交互来写代码以反映此行为。</p>

<p>Shiro在设计上体现了上面的概念，既满足了对软件开发人员的直观性，又保留了在实践中的易用性。</p>

<h2><a name="Architecture-HighLevelOverview"></a>概览</h2>

<p>Shiro的架构主要有三个顶级概念：<tt>Subject</tt>, <tt>SecurityManager</tt>和<tt>Realms</tt>。图中展示了这些组件间的交互，接下来详细介绍：</p>

<p>
<span class="image-wrap" style="display: block; text-align: center"><img src="assets/images/ShiroBasicArchitecture.png" style="border: 0px solid black"></span>
<br clear="none" class="atl-forced-newline"></p>

<ul><li><b>Subject</b>： 正如我们在<a href="tutorial.html" title="教程">教程</a>里提到的, <tt>Subject</tt>实际上是安全领域里的“当前执行用户”。“User”通常意指人类，而<tt>Subject</tt> 却可以是一个人，或者是第三方服务，守护进程帐户，定时任务等等——可以是基本上任何正与软件交互的事物。
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline">
<tt>Subject</tt>的实例都会（也是必须）绑定一个<tt>SecurityManager</tt>，对<tt>Subject</tt>的操作会转为Subject与SecurityManager之间的交互。
<br clear="none" class="atl-forced-newline"></li><li><b>SecurityManager</b>： <tt>SecurityManager</tt>是Shiro架构的核心，像个“保护伞”一样协调内部组件运作。不过一旦SecurityManager配置完成，它就被放一边去了，通常开发人员只需要使用<tt>Subject</tt>。
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline">
稍后详细介绍<tt>SecurityManager</tt>，现在你需要知道的是，当使用<tt>Subject</tt>进行各种操作时，在背后做苦力活的可是<tt>SecurityManager</tt>，这一点在上面的图中有所体现。
<br clear="none" class="atl-forced-newline"></li><li><b>Realms</b>： Realms在Shiro和你的安全数据之间扮演“桥梁”或“连接器”的角色。当需要用到安全数据比如用户帐号来进行认证或授权时，Shiro会从应用配置的一个或多个Realms中来查找。
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline">
这个意义上Realm其实就是安全（操作）特有的<a class="external-link" href="http://en.wikipedia.org/wiki/Data_access_object" rel="nofollow">DAO</a>：它封装了数据源的细节，并在Shiro需要时提供相关数据。配置Shiro时，必须至少得有一个Realm以用于认证（和/或）授权。在<tt>SecurityManager</tt>中可以配置Realm，至少得有一个。
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline">
Shiro自带一些开箱即用的Realms用于连接像是LDAP，关系数据库（JDBC），文本配置源（比如INI）以及属性文件等等这样的安全数据来源。如果默认的不能满足你的需要，你也可以自己实现一个Realm。
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline">
同其他内部组件一样，Realms由<tt>SecurityManager</tt>管理着如何获取数据并传给<tt>Subject</tt>的实例。</li></ul>


<h2><a name="Architecture-DetailedArchitecture"></a>详细架构</h2>

<p>下面是Shiro的核心架构以及一些简短的介绍：</p>

<p><span class="image-wrap" style="display: block; text-align: center"><img src="assets/images/ShiroArchitecture.png" style="border: 0px solid black"></span></p>

<ul><li><b>Subject</b> (<tt><a class="external-link" href="static/current/apidocs/org/apache/shiro/subject/Subject.html">org.apache.shiro.subject.Subject</a></tt>)<br clear="none">
安全视角下与软件交互的实体（用户，第三方服务等等）。
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline"></li><li><b>SecurityManager</b> (<tt><a class="external-link" href="static/current/apidocs/org/apache/shiro/mgt/SecurityManager.html">org.apache.shiro.mgt.SecurityManager</a></tt>)<br clear="none">
如上，<tt>SecurityManager</tt> 是Shiro架构的核心，起协调内部各组件的作用。同样也管理Shiro的所有用户，可以进行用户相关的安全操作。
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline"></li><li><b>Authenticator</b> (<tt><a class="external-link" href="static/current/apidocs/org/apache/shiro/authc/Authenticator.html">org.apache.shiro.authc.Authenticator</a></tt>)<br clear="none">
<tt>Authenticator</tt>是用于执行用户的认证行为的组件，当用户登录时，登录的逻辑操作由<tt>Authenticator</tt>执行。<tt>Authenticator</tt>知道如何与存储用户/帐号信息的一个或多个<tt>Realms</tt>协作。从这些<tt>Realms</tt>获取的数据用于验证用户的真实身份。
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline">
	<ul><li><b>Authentication Strategy</b> (<tt><a class="external-link" href="static/current/apidocs/org/apache/shiro/authc/pam/AuthenticationStrategy.html">org.apache.shiro.authc.pam.AuthenticationStrategy</a></tt>)<br clear="none">
如果配置了不止一个<tt>Realm</tt>，<tt>AuthenticationStrategy</tt>将用来决定什么样的条件下认证会成功或失败（比如，如果一个realm的数据认证成功而其他的却失败了，能算是认证通过吗？还是必须所有的都认证成功？还是只要一个就可以？）。
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline"></li></ul>
	</li><li><b>Authorizer</b> (<tt><a class="external-link" href="static/current/apidocs/org/apache/shiro/authz/Authorizer.html">org.apache.shiro.authz.Authorizer</a></tt>)<br clear="none">
<tt>Authorizer</tt>用于控制程序中用户的访问，最终决定用户是否被允许做什么。和<tt>Authenticator</tt>一样, <tt>Authorizer</tt>也会与底层的数据源交互来获取角色与权限信息，从而准确控制用户的行为。
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline"></li><li><b>SessionManager</b> (<tt><a class="external-link" href="static/current/apidocs/org/apache/shiro/session/mgt/SessionManager.html">org.apache.shiro.session.mgt.SessionManager</a></tt>)<br clear="none">
<tt>SessionManager</tt>可以创建用户<tt>会话（Session）</tt>维护其生命周期并在所有环境中提供了强大的用户体验。Shiro可以管理任何环境下的用户会话，即使是非Web/Servlet或EJB容器下——这是区别于其他安全框架而特有的功能。默认情况下，Shiro会使用（容器）提供的会话管理机制，但如果没有，比如在独立的程序或非Web环境中，Shiro将使用它内置的企业会话管理功能以提供一致的编程体验。<tt>SessionDAO</tt>可使用各种数据源来存储会话。
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline">
	<ul><li><b>SessionDAO</b> (<tt><a class="external-link" href="static/current/apidocs/org/apache/shiro/session/mgt/eis/SessionDAO.html">org.apache.shiro.session.mgt.eis.SessionDAO</a></tt>)<br clear="none">
<tt>SessionDAO</tt>替<tt>SessionManager</tt>执行<tt>会话</tt>的存储操作（CRUD）。任何的数据存储都可以接入到会话管理中。
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline"></li></ul>
	</li><li><b>CacheManager</b> (<tt><a class="external-link" href="static/current/apidocs/org/apache/shiro/cache/CacheManager.html">org.apache.shiro.cache.CacheManager</a></tt>)<br clear="none">
<tt>CacheManager</tt>创建与管理<tt>缓存</tt>的实例与生命周期以供Shiro中的其他组件使用。因为在Shiro中可以使用多个数据源用于认证、授权和会话管理，而缓存可以在使用这些数据源时改善性能，所以也就成为框架中很重要的一个功能。 Shiro中可以使用任何开源或商业的缓存方案。
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline"></li><li><b>Cryptography</b> (<tt><a class="external-link" href="static/current/apidocs/org/apache/shiro/crypto/package-summary.html">org.apache.shiro.crypto.*</a></tt>)<br clear="none">
加密是企业级安全框架固有的功能，Shiro的<tt>crypto</tt>包对密码、哈希和各种编码实现提供了易于使用和理解的封装 。该包下的所有类都为此精心设计，那些用过Java的原生安全加密功能的人应该了解这是多么大的一个挑战。Shiro的加密API简化了Java加密中的复杂性。
<br clear="none" class="atl-forced-newline">
<br clear="none" class="atl-forced-newline"></li><li><b>Realms</b> (<tt><a class="external-link" href="static/current/apidocs/org/apache/shiro/realm/Realm.html">org.apache.shiro.realm.Realm</a></tt>)<br clear="none">
如上所知，Realm在shiro与应用安全数据之间扮演“桥梁”/“连接器”的角色。每当因为执行认证或授权操作而需要像用户帐号等安全相关的数据时，shiro会从程序配置的一个或多个Realm中查询。你可以根据需要配置多个<tt>Realm</tt>。</li></ul>


<h2><a name="Architecture-The%7B%7BSecurityManager%7D%7D"></a><tt>SecurityManager</tt></h2>

<p>因为Shiro的API鼓励开发人员使用以<tt>Subject</tt>为中心的编程方式，所以大多数情况下不会用到<tt>SecurityManager</tt>，即使如此，知道如何配置以及<tt>SecurityManager</tt>的运行机制还是很重要的。</p>

<h2><a name="Architecture-Design"></a>设计</h2>

<p>如之前所说，<tt>SecurityManager</tt> 执行安全（相关）操作并管理应用中所有用户的状态，默认的<tt>SecurityManager</tt>实现中包含：</p>

<ul><li>认证（Authentication）</li><li>授权（Authorization）</li><li>会话管理（Session Management）</li><li>缓存管理（Cache Management）</li><li><a href="realm.html" title="Realm">Realm</a>管理</li><li>事件传播（Event propagation）</li><li>自动登陆服务（"Remember Me" ）</li><li>创建账号</li><li>登陆登出<br clear="none">
等等

<p>但将如此多功能包含在一个组件中，同时又要做到灵活可定制还是挺困难的。</p>

<p>为了简化配置实现灵活的可插拔性，Shiro的实现在设计上高度模块化——甚至SecurityManager（及其继承类）基本上都不用做太多事了，相反， <tt>SecurityManager</tt>更多的是作为一个轻量“容器（container）”， 将功能的实现委托给内部组件。这种“封装器”的设计在上面的架构图中已有体现。</p>

<p>当组件执行逻辑的时候，<tt>SecurityManager</tt>知道如何以及何时去协调组件做出正确的行为。</p>

<p><tt>SecurityManager</tt>和 JavaBean 兼容，这允许你（或者配置途径）通过标准的JavaBean 访问/设置方法（get/set）很容易地定制插件。Shiro 模块可以根据用户行为转化成简易的配置。</p>

<div class="panelMacro"><table class="tipMacro"><colgroup span="1"><col span="1" width="24"><col span="1"></colgroup><tr><td colspan="1" rowspan="1" valign="top"><img align="middle" src="../https@cwiki.apache.org/confluence/images/icons/emoticons/check.gif" width="16" height="16" alt="" border="0"></td><td colspan="1" rowspan="1"><b>简易的配置</b><br clear="none">因为兼容JavaBean，SecurityManager很容易在任何支持Javabean配置的框架或容器中添加组件，如<a href="spring.html" title="Spring">Spring</a>、Guice、JBoss等等。</td></tr></table></div>

<p>接下来讨论 <a href="configuration.html" title="Configuration">配置</a>。</p>


        </div>

    </div><!--END WRAPPER-->

    <div id="footer">

        <div class="wrapper">

            <a href="../www.apache.org/foundation/contributing.html">Donate to the ASF</a> |
            <a href="../www.apache.org/licenses/LICENSE-2.0.html">License</a>
            <p>Copyright &copy; 2008-2014 The Apache Software Foundation</p>
            <div class="footer-shield"></div>

        </div> <!--END FOOTER WRAPPER-->

    </div> <!--END FOOTER-->

</body>
</html>
