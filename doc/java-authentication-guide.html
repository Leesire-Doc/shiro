<!--
   Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-  2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="description" content="Apache Shiro is a powerful and easy-to-use Java security framework that performs authentication, authorization, cryptography, and session management.">
    <meta name="google-site-verification" content="QIax6uT5UX3enoU0G8Pz2pXbQ45KaQuHZ3nCh9V27mw">
    <meta name="msvalidate.01" content="0B57EB46CBFAD8FD45008D2DB6B6C68C">
    <meta name="y_key" content="e47896cd6bae4920">

    <title>
                    Apache Shiro | Java Security Framework
        </title>


    <link rel="icon" type="image/vnd.microsoft.icon" href="assets/images/favicon.ico">

    <link rel="stylesheet" type="text/css" href="assets/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="assets/css/confluence.css" media="screen">
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">

    <script type="text/javascript" src="../ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
    <script type="text/javascript" src="assets/js/jquery_googleanalytics/jquery.google-analytics.js"></script>
    <script type="text/javascript">
        // initialize plugins
        jQuery(function() {
            //Google Analytics
            jQuery.trackPage('UA-55157705-1');
        });
    </script>
</head>

<body>
    <div id="top-bar"></div>

    <div class="wrapper">

        <div id="header">
            <a href="index.html"><div id="logo"></div></a>
            <ul class="navigation">
                <li><a href="get-started.html">Get Started</a></li>
                <li><a href="documentation.html">Docs</a></li>
                <li><a href="web-features.html">Web Apps</a></li>
                <li><a href="integration.html">Integrations</a></li>
                <li><a href="features.html">Features</a></li>
                <li><a href="community.html">Community</a></li>
            </ul>
        </div>

        <div id="content">

            <h1><a name="JavaAuthenticationGuide-JavaAuthenticationGuidewithApacheShiro"></a>Java Authentication Guide with Apache Shiro</h1>

<p><br clear="none" class="atl-forced-newline">
Authentication is the process of identity verification-- you are trying to prove a user is who they say they are. To do so, a user needs to provide some sort of proof of identity that your system understands and trust.</p>

<p>The goal of this guide is to walk you through how Authentication in Java is performed in Shiro. If you haven't already please take moment and go through Shiro's <a href="10-minute-tutorial.html" title="10 Minute Tutorial">10 Minute Tutorial</a> so that you get a basic understanding of how to work with Shiro.</p>

<h2><a name="JavaAuthenticationGuide-Terminologyyou%27llneed"></a>Terminology you'll need</h2>

<table align="right" width="275" style="margin-left: 20px; margin-bottom: 20px; border-style: solid; border-width: 2px; border-color: navy" cellpadding="10px">

<tr>
<td>
<div id="border">
  <h2>Related Content</h2>
	
  <h3><a href="authentication-features.html">Authentication Features</a></h3>
  <p>Quick overview of easy, subject-based authentication in Shiro. </br><span style="font-size:11"><a href="authentication-features.html">Read More &gt;&gt;</a></span></p>
	
  <h3><a href="authentication.html">Authentication Docs</a></h3>
  <p>Full documentation on Apache Shiro's Authentication functionality. </br><span style="font-size:11"><a href="authentication.html">Read More &gt;&gt;</a></span></p>
	
	<h3><a href="10-minute-tutorial.html">10-Minute Shiro Tutorial</a></h3>
  <p>Try Apache Shiro for yourself in under 10 minutes. </br><span style="font-size:11"><a href="10-minute-tutorial.html">Read More &gt;&gt;</a></span></p>
	
	<h3><a href="webapp-tutorial.html">Web App Tutorial</a></h3>
  <p>Step-by-step tutorial for securing a web application with Shiro. </br><span style="font-size:11"><a href="webapp-tutorial.html">Read More &gt;&gt;</a></span></p>

</div>
</td>
</tr>
</table>

<ul><li><b>Subject</b> - Security specific user 'view' of an application user.  It can be a human being, a third-party process, a server connecting to you application application, or even a cron job.  Basically, it is anything or anyone communicating with your application.</li></ul>


<ul><li><b>Principals</b> - A subjects identifying attributes.  First name, last name, social security number, username</li></ul>


<ul><li><b>Credentials</b> - secret data that are used to verify identities.  Passwords, Biometric data, x509 certificates,</li></ul>


<ul><li><b>Realms</b> - Security specific DAO, data access object, software component that talkts to a backend data source. If you have usernames and password in LDAP, then you would have an LDAP Realm that would communicate with LDAP.  The idea is that you would use a realm per back-end data source and Shiro would know how to coordinate with these realms together to do what you have to do.</li></ul>


<h2><a name="JavaAuthenticationGuide-HowtoAuthenticateinJavawithShiro"></a>How to Authenticate in Java with Shiro</h2>

<p>In Shiro's framework, and most every other framework for that matter, the Java authentication process can be broken up into three distinct steps.</p>

<h3><a name="JavaAuthenticationGuide-Steps"></a>Steps</h3>

<ol><li>Collect the subject's principals and credentials</li><li>Submit the principals and credentials to an authentication system.</li><li>Allow access, retry authentication, or block access</li></ol>


<p>Here is some code on how you do this in Shiro Specifically.</p>

<h3><a name="JavaAuthenticationGuide-Step1Collectthesubject%27sprincipalsandcredentials"></a>Step 1 - Collect the subject's principals and credentials</h3>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-comment">//Example using most common scenario:
</span><span class="code-comment">//<span class="code-object">String</span> username and password.  Acquire in
</span><span class="code-comment">//system-specific manner (HTTP request, GUI, etc)
</span>
UsernamePasswordToken token =
 <span class="code-keyword">new</span> UsernamePasswordToken( username, password );

<span class="code-comment">//&#8221;Remember Me&#8221; built-in, just <span class="code-keyword">do</span> <span class="code-keyword">this</span>:
</span>token.setRememberMe(<span class="code-keyword">true</span>);

</pre>
</div></div>

<p>In this particular case, we&#8217;re using a class called <a class="external-link" href="static/current/apidocs/org/apache/shiro/authc/UsernamePasswordToken.html">UsernamePasswordToken</a>.  It is the most common authentication token used in the framework.</p>

<p>We use this token to bundle the username and password we acquired in someway in our Java application.  Maybe they were submitted via a user web form, an HTTP header, or a command line. In Shiro, it does not matter how you acquire them-- it is protocol agnostic.</p>

<p>In this example, we have decided that we want the application to remember users when they return.  So once the token is created, we use Shiro's built-in "Remember-me" feature by setting it to true on the token.  This is done using the token's <tt><a class="external-link" href="static/current/apidocs/org/apache/shiro/authc/UsernamePasswordToken.html#setRememberMe(boolean)">setRememberMe()</a></tt> method</p>

<h3><a name="JavaAuthenticationGuide-Step2Submittheprincipalsandcredentialstoanauthenticationsystem."></a>Step 2 - Submit the principals and credentials to an authentication system.</h3>
<p>So we&#8217;ve collected the information in a token and set it to remember returning users. The next step is in the Authentication process is to submit the token to an authentication system. Your authentication system is represented in Shiro by security-specific DAOs, that are referred to as <a class="external-link" href="static/current/apidocs/default.htm">Realms</a>.  For more information on realms please check out the <a class="external-link" href="realm.html">Shiro Realm Guide</a>.</p>

<p>In Shiro we try to make this part as quick and easy as humanly possible.  We have it down to one line of Java code!</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-comment">//With most of Shiro, you'll always want to make sure you're working with the currently executing user, referred to as the subject
</span>Subject currentUser = SecurityUtils.getSubject();

<span class="code-comment">//Authenticate the subject by passing
</span><span class="code-comment">//the user name and password token
</span><span class="code-comment">//into the login method
</span>currentUser.login(token);
</pre>
</div></div>

<p>First, we need to acquire the currently executing user, referred to as the subject.   A subject is just a security specific view of the user----it can be a human, a process, cron job, doesn&#8217;t matter. In Shiro, there is always a subject instance available to the currently executing thread.  The concept of a subject is core to Shiro and most of the framework is centered around working with subjects. In this example, we will name this instance of subject currentUser.</p>

<p>To acquire the subject, we use the <a class="external-link" href="static/current/apidocs/org/apache/shiro/SecurityUtils.html">SecurityUtils</a> class which is also a core pat of Shiro's API.  It will acquire the currently executing user via the <tt><a class="external-link" href="static/current/apidocs/org/apache/shiro/SecurityUtils.html#getSubject()">getsubject()</a></tt> method call.  And we get back a subject instance that is representing who the current user is who is interacting with the system.  At this point in the example, the subject currentUser is anonymous.  There is no identity associated with them.</p>

<p>Now with the user representation in hand, we authenticate them by just calling the <tt><a class="external-link" href="static/current/apidocs/org/apache/shiro/subject/Subject.html#login(org.apache.shiro.authc.AuthenticationToken))">login()</a></tt> method and submit the token we just constructed a second ago.</p>

<h3><a name="JavaAuthenticationGuide-Step3Allowaccess%2Cretryauthentication%2Corblockaccess"></a>Step 3 - Allow access, retry authentication, or block access</h3>
<p>Again really, really easy, single method call.  If the <tt>login()</tt> method call is successful, then the user is logged in and associated with a user account or identity.  From here, the user can go about using your application and retain their identity through their session or longer since we have set the "Remember Me" in our example.</p>

<p>But what happens if something fails in the authentication attempt?  What if they give you the wrong password or they accessed the system too many times, maybe their account is locked?  In this case, Shiro will throw an exception. This is where Shiro's rich exception hierarchy comes into play.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
<span class="code-keyword">try</span> {
    currentUser.login(token);
} <span class="code-keyword">catch</span> ( UnknownAccountException uae ) { ...
} <span class="code-keyword">catch</span> ( IncorrectCredentialsException ice ) { ...
} <span class="code-keyword">catch</span> ( LockedAccountException lae ) { ...
} <span class="code-keyword">catch</span> ( ExcessiveAttemptsException eae ) { ...
} ... <span class="code-keyword">catch</span> your own ...
} <span class="code-keyword">catch</span> ( AuthenticationException ae ) {
    <span class="code-comment">//unexpected error?
</span>}
<span class="code-comment">//No problems, show authenticated view&#8230;</span>
</pre>
</div></div>

<p>You can take that method call and wrap it in a try/catch block and you can catch all sort of exceptions if you want to handle them and react accordingly.  In addition to a rich set of exceptions that Shiro offers, you can create your own if you need custom functionality.  For more information, follow this link documentation on <a class="external-link" href="static/current/apidocs/org/apache/shiro/authc/AuthenticationException.html">AuthenticationException</a>.</p>

<div class="panelMacro"><table class="tipMacro"><colgroup span="1"><col span="1" width="24"><col span="1"></colgroup><tr><td colspan="1" rowspan="1" valign="top"><img align="middle" src="../https@cwiki.apache.org/confluence/images/icons/emoticons/check.gif" width="16" height="16" alt="" border="0"></td><td colspan="1" rowspan="1"><b>Security Tip</b><br clear="none">Security best practice is to give generic login failure messages to users because you do not want to aid an attacker trying to break into your system.</td></tr></table></div>

<h2><a name="JavaAuthenticationGuide-%22RememberMe%22Support"></a>"Remember Me" Support</h2>

<p>As shown in the example above, Shiro supports the notion of "remember me" in adition to the normal login process. &#160;</p>

<p>In Shiro, the Subject object supports two methods : <tt><a class="external-link" href="static/current/apidocs/org/apache/shiro/subject/Subject.html#isRemembered()">isRemembered()</a></tt> and <tt><a class="external-link" href="static/current/apidocs/org/apache/shiro/subject/Subject.html#isAuthenticated()">isAuthenticated()</a></tt>.</p>

<p>A "remembered" subject has an identity (it is not anonymous) and their identifying attributes,referred to as principals, are remembered from a successful authentication during a previous session.</p>

<p>An authenticated subject has proved their identity <em>during their current session</em>.</p>

<div class="panelMacro"><table class="warningMacro"><colgroup span="1"><col span="1" width="24"><col span="1"></colgroup><tr><td colspan="1" rowspan="1" valign="top"><img align="middle" src="../https@cwiki.apache.org/confluence/images/icons/emoticons/forbidden.gif" width="16" height="16" alt="" border="0"></td><td colspan="1" rowspan="1"><b>Warning</b><br clear="none">If a subject is remembered, it DOES NOT mean they are authenticated.</td></tr></table></div>

<h3><a name="JavaAuthenticationGuide-RememberedvsAuthenticated"></a>Remembered vs Authenticated</h3>
<p>In shiro it is very important to note that a remembered subject is not an authenticated subject. A check against <tt>isAuthenticated()</tt> is a much more strict check because authentication is the process of proving you are who you say you are. When a user is only remembered, the remembered identity gives the system an idea who that user probably is, but in reality, has no way of absolutely guaranteeing if the remembered Subject represents the user currently using the application. Once the subject is authenticated, they are no longer considered only remembered because their identity would have been verified during the current session.</p>

<p>So although many parts of the application can still perform user-specific logic based on the remembered principals, such as customized views, it should never perform highly-sensitive operations until the user has legitimately verified their identity by executing a successful authentication attempt.</p>

<p>For example, a check to see if a subject can access financial information should almost always depend on <tt>isAuthenticated()</tt>, not <tt>isRemembered()</tt>, to guarantee a verified identity.</p>

<p>He is a scenario to help illustrate why the the distinction between isAuthenticated and isRemembered is important.</p>

<p>Let's say you're using Amazon.com. You log in and you add some books to your shopping cart.  A day goes by.  Of course your user session has expired and you've been logged out. But Amazon "remembers" you, greets you by name, and is still giving you personalized book recommendations.  To Amazon, <tt>isRemembered()</tt> would return <tt>TRUE</tt>.  What happens if you try to use one of the credit cards on file or change your account information?  While Amazon "remembers" you, <tt>isRemembered() = TRUE</tt>, it is not certain that you are in fact you, <tt>isAuthenticated()=FALSE</tt>.  So before you can perform a sensitive action Amazon needs to verify your identity by forcing an authentication process which it does through a login screen.  After the login, your identity has been verified and <tt>isAuthenticated()=TRUE</tt>.</p>

<p>This scenario happens very often over the web so the functionality is built into Shiro helping you easily make the distinction yourself.</p>

<h2><a name="JavaAuthenticationGuide-LoggingOut"></a>Logging Out</h2>
<p>Finally, when the user is done using the application, they can log out.  And in Shiro, we make logging out quick and easy with a single method call.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">
currentUser.logout(); <span class="code-comment">//removes all identifying information and invalidates their session too.</span>
</pre>
</div></div>

<p>When you log out in Shiro it will close out the user session and removes any associated identity from the subject instance.  If you're using RememberMe in a web environment, then <tt>.logout()</tt> will, by default, also delete the RememberMe cookie from the browser.</p>

<h2><a name="JavaAuthenticationGuide-Lendahandwithdocumentation"></a>Lend a hand with documentation </h2>

<p>While we hope this documentation helps you with the work you're doing with Apache Shiro, the community is improving and expanding the documentation all the time.  If you'd like to help the Shiro project, please consider corrected, expanding, or adding documentation where you see a need. Every little bit of help you provide expands the community and in turn improves Shiro. </p>

<p>The easiest way to contribute your documentation is to send it to the <a class="external-link" href="../shiro-user.582556.n2.nabble.com/default.htm" rel="nofollow">User Forum</a> or the <a href="mailing-lists.html" title="Mailing Lists">User Mailing List</a>.</p>


        </div>

    </div><!--END WRAPPER-->

    <div id="footer">

        <div class="wrapper">

            <a href="../www.apache.org/foundation/contributing.html">Donate to the ASF</a> |
            <a href="../www.apache.org/licenses/LICENSE-2.0.html">License</a>
            <p>Copyright &copy; 2008-2014 The Apache Software Foundation</p>
            <div class="footer-shield"></div>

        </div> <!--END FOOTER WRAPPER-->

    </div> <!--END FOOTER-->

</body>
</html>
